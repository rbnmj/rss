<!DOCTYPE html>
<html lang="en">
<head>
  <title>{{siteTitle}}</title>
  <meta charset="utf-8" />
  <!-- Keep existing meta tags and styles -->
  <link href="index.css" rel="stylesheet" />
</head>

<body style="background-color:#dce6dc; font-family: 'Computer Modern', sans-serif;">
  <header>
    <dl>
      <a href="https://rbnmj.github.io">back</a>
      <dt><b>Built on</b></dt><dd>{{siteBuildTimestamp}}</dd>
    </dl>
  </header>

  <!-- Add this dropdown section -->
  <section style="margin: 20px 0;">
    <label>Filter by tag:</label>
    <select id="tag-filter" onchange="filterArticles()">
      <option value="all">All</option>
    </select>
  </section>

  <ul>
    {{#each dates}}
    <li>
      <section>
        <h3>{{isoPublishDate}}</h3>
        {{#each articles}}
        <article class="article-item" data-tags="{{source.tags}}">
          <strong><a href="{{link}}">{{title}}</a></strong>
          <div>
            <span><a href="{{source.siteUrl}}">{{source.title}}</a></span> | 
            <span><time>{{publishedOn}}</time></span>
          </div>
          <p>{{description}}</p>
          <hr>
        </article>
        {{/each}}
      </section>
    </li>
    {{/each}}
  </ul>

  <script>
    window.onload = () => {
      const tags = new Set();

      // Collect unique tags from all articles
      document.querySelectorAll('.article-item').forEach(article => {
        const rawTags = article.getAttribute('data-tags') || 'none';
        rawTags.split(',').forEach(tag => {
          if (tag.trim() && tag.trim() !== 'none') {
            tags.add(tag.trim());
          }
        });
      });

      // Populate dropdown with collected tags
      const dropdown = document.getElementById('tag-filter');
      Array.from(tags).sort().forEach(tag => {
        const option = document.createElement('option');
        option.value = tag;
        option.textContent = tag;
        dropdown.appendChild(option);
      });
    };

    function filterArticles() {
      const selectedTag = document.getElementById('tag-filter').value;
      document.querySelectorAll('.article-item').forEach(article => {
        const rawTags = article.getAttribute('data-tags') || 'none';
        const articleTags = rawTags.split(',').map(tag => tag.trim());
        
        if (selectedTag === 'all' || articleTags.includes(selectedTag)) {
          article.style.display = 'block';
        } else {
          article.style.display = 'none';
        }
      });
    }
  </script>
</body>
</html>
